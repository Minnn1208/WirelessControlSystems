C51 COMPILER V9.00   IIC                                                                   03/12/2024 14:42:16 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE IIC
OBJECT MODULE PLACED IN .\Objects\iic.obj
COMPILER INVOKED BY: E:\Keil4\C51\BIN\C51.EXE App\iic\iic.c LARGE BROWSE INCDIR(.\App\24c02;.\App\iic;.\App\serial_debug
                    -;.\Public) DEBUG OBJECTEXTEND PRINT(.\Listings\iic.lst) OBJECT(.\Objects\iic.obj)

line level    source

   1          #include "iic.h"
   2          
   3          
   4          
   5          void iic_start(void)
   6          {
   7   1              IIC_SDA=1;//如果把该条语句放在SCL后面，第二次读写会出现问题
   8   1              delay_10us(1);
   9   1              IIC_SCL=1;
  10   1              delay_10us(1);
  11   1              IIC_SDA=0;      
  12   1              delay_10us(1);
  13   1              IIC_SCL=0;
  14   1              delay_10us(1);
  15   1      }
  16          
  17          
  18          
  19          void iic_stop(void)
  20          {       
  21   1              IIC_SDA=0;
  22   1              delay_10us(1);
  23   1              IIC_SCL=1;
  24   1              delay_10us(1);
  25   1              IIC_SDA=1;      //当SCL为高电平时，SDA由低变为高
  26   1              delay_10us(1);                  
  27   1      }
  28          
  29          
  30          void iic_ack(void)
  31          {
  32   1              IIC_SCL=0;
  33   1              IIC_SDA=0;      //SDA为低电平
  34   1              delay_10us(1);
  35   1              IIC_SCL=1;
  36   1              delay_10us(1);
  37   1              IIC_SCL=0;
  38   1      }
  39          
  40          
  41          
  42          void iic_nack(void)
  43          {
  44   1              IIC_SCL=0;
  45   1              IIC_SDA=1;      //SDA为高电平
  46   1              delay_10us(1);
  47   1              IIC_SCL=1;
  48   1              delay_10us(1);
  49   1              IIC_SCL=0;      
  50   1      }
  51          
  52          
  53          u8 iic_wait_ack(void)
  54          {
C51 COMPILER V9.00   IIC                                                                   03/12/2024 14:42:16 PAGE 2   

  55   1              u8 time_temp=0;
  56   1              
  57   1              IIC_SCL=1;
  58   1              delay_10us(1);
  59   1              while(IIC_SDA)  //等待SDA为低电平
  60   1              {
  61   2                      time_temp++;
  62   2                      if(time_temp>100)//超时则强制结束IIC通信
  63   2                      {       
  64   3                              iic_stop();
  65   3                              return 1;       
  66   3                      }                       
  67   2              }
  68   1              IIC_SCL=0;
  69   1              return 0;       
  70   1      }
  71          
  72          
  73          void iic_write_byte(u8 dat)
  74          {                        
  75   1          u8 i=0; 
  76   1                          
  77   1          IIC_SCL=0;
  78   1          for(i=0;i<8;i++)    //循环8次将一个字节传出，先传高再传低位
  79   1          {              
  80   2              if((dat&0x80)>0) 
  81   2                              IIC_SDA=1;
  82   2                      else
  83   2                              IIC_SDA=0;
  84   2              dat<<=1;          
  85   2                      delay_10us(1);  
  86   2                      IIC_SCL=1;
  87   2                      delay_10us(1); 
  88   2                      IIC_SCL=0;      
  89   2                      delay_10us(1);
  90   2          }    
  91   1      }
  92          
  93          
  94          u8 iic_read_byte(u8 ack)
  95          {
  96   1              u8 i=0,receive=0;
  97   1              
  98   1          for(i=0;i<8;i++ )   //循环8次将一个字节读出，先读高再传低位
  99   1              {
 100   2              IIC_SCL=0; 
 101   2              delay_10us(1);
 102   2                      IIC_SCL=1;
 103   2              receive<<=1;
 104   2              if(IIC_SDA)receive++;   
 105   2                      delay_10us(1); 
 106   2          }                                    
 107   1          if (!ack)
 108   1              iic_nack();
 109   1          else
 110   1              iic_ack();  
 111   1                        
 112   1          return receive;
 113   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V9.00   IIC                                                                   03/12/2024 14:42:16 PAGE 3   

   CODE SIZE        =    299    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       6
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
